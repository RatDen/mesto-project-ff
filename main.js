(()=>{"use strict";function t(t,e,n,o,r,u){var c=e.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__like-button");return c.dataset.id=t._id,a.src=t.link,a.alt=t.name,a.addEventListener("click",(function(t){return r(t)})),c.querySelector(".card__title").textContent=t.name,c.querySelector(".card__like-counter").textContent=t.likes.length,t.likes.some((function(t){return t._id==u.userId}))&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(t){return o(t,u)})),t.owner._id!==u.userId?c.querySelector(".card__delete-button").remove():c.querySelector(".card__delete-button").addEventListener("click",(function(t){return n(t)})),c}function e(t,e){var n=t.target.closest(".card"),o=n.querySelector(".card__like-counter"),r=null;r=t.target.classList.contains("card__like-button_is-active")?function(t,e){return fetch(t.url+t.group+"/cards/likes/"+e,{method:"DELETE",headers:{authorization:t.token}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(e,n.dataset.id):function(t,e){return fetch(t.url+t.group+"/cards/likes/"+e,{method:"PUT",headers:{authorization:t.token}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(e,n.dataset.id),r&&r.then((function(e){o.textContent=e.likes.length,t.target.classList.toggle("card__like-button_is-active")}))}function n(t){t.classList.add("popup_is-opened"),window.addEventListener("keydown",r)}function o(t){t.classList.remove("popup_is-opened"),window.removeEventListener("keydown",r)}function r(t){"Escape"===t.key&&o(document.querySelector(".popup_is-opened"))}function u(t,e){return t.parentNode.querySelector(e)}function c(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove("button_inactive"),e.disabled=!1):(e.classList.add("button_inactive"),e.disabled=!0)}function a(t){var e=Array.from(t.querySelectorAll("input")),n=t.querySelector('button[type="submit"]');e.forEach((function(t){t.classList.remove("popup__input-error")})),c(e,n)}var i={url:"https://nomoreparties.co/v1/",group:"wff-cohort-11",token:"7067014e-808a-4e5e-8222-98d5ce1556a4",userId:null},l=document.querySelector(".places__list"),s=document.querySelector("#card-template").content,p=document.querySelector(".profile__image"),d=document.querySelector(".profile__add-button"),f=document.querySelector(".profile__edit-button"),_=document.querySelector(".popup_type_edit-profile-avatar"),m=_.querySelector(".popup__button"),y=document.querySelector(".popup_type_edit-profile-name"),h=y.querySelector(".popup__button"),v=document.querySelector(".popup_type_new-card"),g=v.querySelector(".popup__button"),S=document.querySelector(".popup_type_image"),k=S.querySelector(".popup__image"),q=S.querySelector(".popup__caption"),b=document.querySelector(".popup_type_confirm"),E=b.querySelector(".popup__button"),L=_.querySelector(".popup__form").querySelector("input"),C=y.querySelector(".popup__form"),x=C.querySelector(".popup__input_type_name"),j=C.querySelector(".popup__input_type_description"),P=v.querySelector(".popup__form"),A=(P.querySelectorAll("input"),document.querySelector(".profile__title")),T=document.querySelector(".profile__description"),w=document.querySelector(".profile__image"),z=P.querySelector(".popup__input_type_card-name"),I=P.querySelector(".popup__input_type_url");function D(t){t.preventDefault();var e=t.target.closest(".card");E.dataset.targetId=e.dataset.id,n(b)}function N(t){k.src=t.target.src,k.alt=t.target.alt,q.textContent=t.target.alt,n(S)}function O(t){A.textContent=t.name,T.textContent=t.about,w.style.backgroundImage="url(".concat(t.avatar,")"),i.userId=t._id}document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("click",(function(t){t.target===t.currentTarget&&o(t.target)}))})),p.addEventListener("click",(function(){return n(_)})),f.addEventListener("click",(function(){x.value=A.textContent,j.value=T.textContent,a(y),n(y)})),d.addEventListener("click",(function(){return n(v)})),document.querySelectorAll(".popup__close").forEach((function(t){return t.addEventListener("click",(function(t){o(t.target.closest(".popup"))}))})),m.addEventListener("click",(function(t){t.preventDefault(),m.textContent="Сохранение...",function(t,e){return fetch(t.url+t.group+"/users/me/avatar",{method:"PATCH",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(i,L.value).then((function(t){return O(t)})).then((function(){o(_),m.textContent="Сохранить"}))})),C.addEventListener("submit",(function(t){t.preventDefault(),A.textContent=x.value,T.textContent=j.value,h.textContent="Сохранение...",function(t,e){return fetch(t.url+t.group+"/users/me",{method:"PATCH",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(i,{name:x.value,about:j.value}).then((function(t){return O(t)})).then((function(){o(y),h.textContent="Сохранить"}))})),P.addEventListener("submit",(function(n){n.preventDefault();var r={name:z.value,link:I.value};g.textContent="Сохранение...",function(t,e){return fetch(t.url+t.group+"/cards",{method:"POST",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(i,r).then((function(n){l.prepend(t(n,s,D,e,N,i)),o(v),g.textContent="Сохранить",P.reset(),a(v)}))})),E.addEventListener("click",(function(t){t.preventDefault(),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&function(t,e){fetch(t.url+t.group+"/cards/"+e,{method:"DELETE",headers:{authorization:t.token}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(e,t),document.querySelector('.card[data-id="'.concat(t,'"]')).remove()}(t.target.dataset.targetId,i),t.target.dataset.targetId="",o(b)})),Array.from(document.forms).forEach((function(t){return function(t){var e=Array.from(t.querySelectorAll(".popup__input")),n=t.querySelector('button[type="submit"]');c(e,n),t.addEventListener("input",(function(t){var o;(o=t.target).validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid?function(t){u(t,".popup__input-error_text").textContent="",t.classList.remove("popup__input-error")}(o):function(t,e){u(t,".popup__input-error_text").textContent=e,t.classList.add("popup__input-error")}(o,o.validationMessage),c(e,n)}))}(t)})),Promise.all([function(t){return fetch(t.url+t.group+"/users/me",{headers:{authorization:t.token}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(i),function(t){return fetch(t.url+t.group+"/cards",{headers:{authorization:t.token}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(i)]).then((function(n){O(n[0]),n[1].forEach((function(n){return l.append(t(n,s,D,e,N,i))}))}))})();