(()=>{"use strict";var t={url:"https://nomoreparties.co/v1/",group:"wff-cohort-11",token:"7067014e-808a-4e5e-8222-98d5ce1556a4",userId:null};function e(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function n(n){return fetch(t.url+t.group+"/cards/likes/"+n,{method:"PUT",headers:{authorization:t.token}}).then((function(t){return e(t)}))}function r(n){return fetch(t.url+t.group+"/cards/likes/"+n,{method:"DELETE",headers:{authorization:t.token}}).then((function(t){return e(t)}))}function o(t,e,n,r,o,u){var c=e.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__image"),a=c.querySelector(".card__like-button");return c.dataset.id=t._id,i.src=t.link,i.alt=t.name,i.addEventListener("click",(function(t){return o(t)})),c.querySelector(".card__title").textContent=t.name,c.querySelector(".card__like-counter").textContent=t.likes.length,t.likes.some((function(t){return t._id==u}))&&a.classList.add("card__like-button_is-active"),a.addEventListener("click",(function(t){return r(t,u)})),t.owner._id!==u?c.querySelector(".card__delete-button").remove():c.querySelector(".card__delete-button").addEventListener("click",(function(t){return n(t)})),c}function u(t){var e=t.target.closest(".card"),o=e.querySelector(".card__like-counter");(t.target.classList.contains("card__like-button_is-active")?r:n)(e.dataset.id).then((function(e){o.textContent=e.likes.length,t.target.classList.toggle("card__like-button_is-active")}))}function c(t){t.classList.add("popup_is-opened"),window.addEventListener("keydown",a)}function i(t){t.classList.remove("popup_is-opened"),window.removeEventListener("keydown",a)}function a(t){"Escape"===t.key&&i(document.querySelector(".popup_is-opened"))}function l(t,e){return t.parentNode.querySelector(e)}function p(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(t){s(t)})),d(n,r)}function d(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove("button_inactive"),e.disabled=!1):(e.classList.add("button_inactive"),e.disabled=!0)}function s(t){l(t,".popup__input-error_text").textContent="",t.classList.remove("popup__input-error")}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _,y={},m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:'button[type="submit"]',inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},v=document.querySelector(".places__list"),h=document.querySelector("#card-template").content,S=document.querySelector(".profile__image"),g=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit-profile-avatar"),k=b.querySelector(".popup__button"),C=document.querySelector(".popup_type_edit-profile-name"),E=C.querySelector(".popup__button"),L=document.querySelector(".popup_type_new-card"),x=L.querySelector(".popup__button"),A=document.querySelector(".popup_type_image"),w=A.querySelector(".popup__image"),T=A.querySelector(".popup__caption"),j=document.querySelector(".popup_type_confirm"),z=j.querySelector(".popup__button"),I=b.querySelector(".popup__form").querySelector("input"),O=C.querySelector(".popup__form"),D=O.querySelector(".popup__input_type_name"),P=O.querySelector(".popup__input_type_description"),N=L.querySelector(".popup__form"),B=(N.querySelectorAll("input"),document.querySelector(".profile__title")),M=document.querySelector(".profile__description"),J=document.querySelector(".profile__image"),H=N.querySelector(".popup__input_type_card-name"),U=N.querySelector(".popup__input_type_url");function V(t){t.preventDefault();var e=t.target.closest(".card");z.dataset.targetId=e.dataset.id,c(j)}function $(t){w.src=t.target.src,w.alt=t.target.alt,T.textContent=t.target.alt,c(A)}function F(t){B.textContent=t.name,M.textContent=t.about,J.style.backgroundImage="url(".concat(t.avatar,")"),y.id=t._id}document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("click",(function(t){return function(t){t.target===t.currentTarget&&i(t.target)}(t)}))})),S.addEventListener("click",(function(){return c(b)})),q.addEventListener("click",(function(){D.value=B.textContent,P.value=M.textContent,p(C,m),c(C)})),g.addEventListener("click",(function(){return c(L)})),document.querySelectorAll(".popup__close").forEach((function(t){t.addEventListener("click",(function(t){i(t.target.closest(".popup"))}))})),k.addEventListener("click",(function(n){var r;n.preventDefault(),k.textContent="Сохранение...",(r=I.value,fetch(t.url+t.group+"/users/me/avatar",{method:"PATCH",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})}).then((function(t){return e(t)}))).then((function(t){F(t),i(b)})).catch((function(t){console.log(t)})).finally((function(){k.textContent="Сохранить"}))})),O.addEventListener("submit",(function(n){var r;n.preventDefault(),B.textContent=D.value,M.textContent=P.value,E.textContent="Сохранение...",(r={name:D.value,about:P.value},fetch(t.url+t.group+"/users/me",{method:"PATCH",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({name:r.name,about:r.about})}).then((function(t){return e(t)}))).then((function(t){F(t),i(C)})).catch((function(t){console.log(t)})).finally((function(){E.textContent="Сохранить"}))})),N.addEventListener("submit",(function(n){n.preventDefault();var r={name:H.value,link:U.value};x.textContent="Сохранение...",function(n){return fetch(t.url+t.group+"/cards",{method:"POST",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({name:n.name,link:n.link})}).then((function(t){return e(t)}))}(r).then((function(t){v.prepend(o(t,h,V,u,$,y.id)),i(L),N.reset(),p(L,m)})).catch((function(t){console.log(t)})).finally((function(){x.textContent="Сохранить"}))})),z.addEventListener("click",(function(n){var r;n.preventDefault(),r=n.target.dataset.targetId,y.id,function(n){return fetch(t.url+t.group+"/cards/"+n,{method:"DELETE",headers:{authorization:t.token}}).then((function(t){return e(t)}))}(r).then((function(){document.querySelector('.card[data-id="'.concat(r,'"]')).remove()})),n.target.dataset.targetId="",i(j)})),_=m,document.querySelectorAll(_.formSelector).forEach((function(t){var e=Array.from(t.querySelectorAll(_.inputSelector)),n=t.querySelector(_.submitButtonSelector);d(e,n),t.addEventListener("input",(function(t){var r;(r=t.target).validity.patternMismatch?r.setCustomValidity(r.dataset.errorMessage):r.setCustomValidity(""),r.validity.valid?s(r):function(t,e){l(t,".popup__input-error_text").textContent=e,t.classList.add("popup__input-error")}(r,r.validationMessage),d(e,n)}))})),Promise.all([fetch(t.url+t.group+"/users/me",{headers:{authorization:t.token}}).then((function(t){return e(t)})),fetch(t.url+t.group+"/cards",{headers:{authorization:t.token}}).then((function(t){return e(t)}))]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,u,c,i=[],a=!0,l=!1;try{if(u=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=u.call(n)).done)&&(i.push(r.value),i.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{if(!a&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],i=r[1];F(c),i.forEach((function(t){return v.append(o(t,h,V,u,$,y.id))}))})).catch((function(t){console.log(t)}))})();